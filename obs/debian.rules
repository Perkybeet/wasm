#!/usr/bin/make -f

export PYBUILD_NAME=wasm
export DH_VERBOSE=1

%:
	dh $@ --with python3 --buildsystem=pybuild

override_dh_auto_install:
	dh_auto_install
	# Create config directory
	install -d debian/wasm/etc/wasm
	# Install default config
	install -m 644 debian/wasm.default.yaml debian/wasm/etc/wasm/config.yaml
	# Create apps directory
	install -d debian/wasm/var/www/apps
	# Create log directory
	install -d debian/wasm/var/log/wasm
	# Install bash completion
	install -d debian/wasm/usr/share/bash-completion/completions
	install -m 644 src/wasm/completions/wasm.bash debian/wasm/usr/share/bash-completion/completions/wasm
	# Install zsh completion
	install -d debian/wasm/usr/share/zsh/vendor-completions
	install -m 644 src/wasm/completions/_wasm debian/wasm/usr/share/zsh/vendor-completions/_wasm
	# Install fish completion
	install -d debian/wasm/usr/share/fish/vendor_completions.d
	install -m 644 src/wasm/completions/wasm.fish debian/wasm/usr/share/fish/vendor_completions.d/wasm.fish

override_dh_installsystemd:
	dh_installsystemd --no-enable --no-start

override_dh_auto_test:
	@echo "Skipping tests during package build"